!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).kriging_contour={})}(this,(function(t){"use strict";function e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var r,n;1===(r=e).length&&(n=r,r=function(t,r){return e(n(t),r)});var o=Math.sqrt(50),i=Math.sqrt(10),s=Math.sqrt(2);function l(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}var u=Array.prototype.slice;function h(t,e){return t-e}function f(t){return function(){return t}}function a(t,e){for(var r,n=-1,o=e.length;++n<o;)if(r=c(t,e[n]))return r;return 0}function c(t,e){for(var r=e[0],n=e[1],o=-1,i=0,s=t.length,l=s-1;i<s;l=i++){var u=t[i],h=u[0],f=u[1],a=t[l],c=a[0],g=a[1];if(p(u,a,e))return 0;f>n!=g>n&&r<(c-h)*(n-f)/(g-f)+h&&(o=-o)}return o}function p(t,e,r){var n,o,i,s;return function(t,e,r){return(e[0]-t[0])*(r[1]-t[1])==(r[0]-t[0])*(e[1]-t[1])}(t,e,r)&&(o=t[n=+(t[0]===e[0])],i=r[n],s=e[n],o<=i&&i<=s||s<=i&&i<=o)}function g(){}var y=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function x(){var t=1,e=1,r=l,n=v;function c(t){var e=r(t);if(Array.isArray(e))e=e.slice().sort(h);else{var n=function(t,e){var r,n,o,i=t.length,s=-1;if(null==e){for(;++s<i;)if(null!=(r=t[s])&&r>=r)for(n=o=r;++s<i;)null!=(r=t[s])&&(n>r&&(n=r),o<r&&(o=r))}else for(;++s<i;)if(null!=(r=e(t[s],s,t))&&r>=r)for(n=o=r;++s<i;)null!=(r=e(t[s],s,t))&&(n>r&&(n=r),o<r&&(o=r));return[n,o]}(t),l=n[0],u=n[1];e=function(t,e,r){var n=Math.abs(e-t)/Math.max(0,r),l=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),u=n/l;return u>=o?l*=10:u>=i?l*=5:u>=s&&(l*=2),e<t?-l:l}(l,u,e),e=function(t,e,r){t=+t,e=+e,r=(o=arguments.length)<2?(e=t,t=0,1):o<3?1:+r;for(var n=-1,o=0|Math.max(0,Math.ceil((e-t)/r)),i=new Array(o);++n<o;)i[n]=t+n*r;return i}(Math.floor(l/e)*e,Math.floor(u/e)*e,e)}return e.map((function(e){return p(t,e)}))}function p(r,o){var i=[],s=[];return function(r,n,o){var i,s,l,u,h,f,a=new Array,c=new Array;i=s=-1,u=r[0]>=n,y[u<<1].forEach(p);for(;++i<t-1;)l=u,u=r[i+1]>=n,y[l|u<<1].forEach(p);y[u|0].forEach(p);for(;++s<e-1;){for(i=-1,u=r[s*t+t]>=n,h=r[s*t]>=n,y[u<<1|h<<2].forEach(p);++i<t-1;)l=u,u=r[s*t+t+i+1]>=n,f=h,h=r[s*t+i+1]>=n,y[l|u<<1|h<<2|f<<3].forEach(p);y[u|h<<3].forEach(p)}i=-1,h=r[s*t]>=n,y[h<<2].forEach(p);for(;++i<t-1;)f=h,h=r[s*t+i+1]>=n,y[h<<2|f<<3].forEach(p);function p(t){var e,r,n=[t[0][0]+i,t[0][1]+s],l=[t[1][0]+i,t[1][1]+s],u=x(n),h=x(l);(e=c[u])?(r=a[h])?(delete c[e.end],delete a[r.start],e===r?(e.ring.push(l),o(e.ring)):a[e.start]=c[r.end]={start:e.start,end:r.end,ring:e.ring.concat(r.ring)}):(delete c[e.end],e.ring.push(l),c[e.end=h]=e):(e=a[h])?(r=c[u])?(delete a[e.start],delete c[r.end],e===r?(e.ring.push(l),o(e.ring)):a[r.start]=c[e.end]={start:r.start,end:e.end,ring:r.ring.concat(e.ring)}):(delete a[e.start],e.ring.unshift(n),a[e.start=u]=e):a[u]=c[h]={start:u,end:h,ring:[n,l]}}y[h<<3].forEach(p)}(r,o,(function(t){n(t,r,o),function(t){for(var e=0,r=t.length,n=t[r-1][1]*t[0][0]-t[r-1][0]*t[0][1];++e<r;)n+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return n}(t)>0?i.push([t]):s.push(t)})),s.forEach((function(t){for(var e,r=0,n=i.length;r<n;++r)if(-1!==a((e=i[r])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:o,coordinates:i}}function x(e){return 2*e[0]+e[1]*(t+1)*4}function v(r,n,o){r.forEach((function(r){var i,s=r[0],l=r[1],u=0|s,h=0|l,f=n[h*t+u];s>0&&s<t&&u===s&&(i=n[h*t+u-1],r[0]=s+(o-i)/(f-i)-.5),l>0&&l<e&&h===l&&(i=n[(h-1)*t+u],r[1]=l+(o-i)/(f-i)-.5)}))}return c.contour=p,c.size=function(r){if(!arguments.length)return[t,e];var n=Math.ceil(r[0]),o=Math.ceil(r[1]);if(!(n>0&&o>0))throw new Error("invalid size");return t=n,e=o,c},c.thresholds=function(t){return arguments.length?(r="function"==typeof t?t:Array.isArray(t)?f(u.call(t)):f(t),c):r},c.smooth=function(t){return arguments.length?(n=t?v:g,c):n===v},c}function v(t,e){var r,n=[0].rep(e*e);for(r=0;r<e;r++)n[r*e+r]=t;return n}function d(t,e,r,n){var o,i,s=Array(r*n);for(o=0;o<r;o++)for(i=0;i<n;i++)s[o*n+i]=t[o*n+i]+e[o*n+i];return s}function m(t,e,r,n,o){var i,s,l,u=Array(r*o);for(i=0;i<r;i++)for(s=0;s<o;s++)for(u[i*o+s]=0,l=0;l<n;l++)u[i*o+s]+=t[i*n+l]*e[l*o+s];return u}function b(t,e){var r,n,o,i=Array(e);for(r=0;r<e;r++)i[r]=t[r*e+r];for(r=0;r<e;r++){for(n=0;n<r;n++)i[r]-=t[r*e+n]*t[r*e+n];if(i[r]<=0)return!1;for(i[r]=Math.sqrt(i[r]),n=r+1;n<e;n++){for(o=0;o<r;o++)t[n*e+r]-=t[n*e+o]*t[r*e+o];t[n*e+r]/=i[r]}}for(r=0;r<e;r++)t[r*e+r]=i[r];return!0}function E(t,e){var r,n,o,i;for(r=0;r<e;r++)for(t[r*e+r]=1/t[r*e+r],n=r+1;n<e;n++){for(i=0,o=r;o<n;o++)i-=t[n*e+o]*t[o*e+r];t[n*e+r]=i/t[n*e+n]}for(r=0;r<e;r++)for(n=r+1;n<e;n++)t[r*e+n]=0;for(r=0;r<e;r++){for(t[r*e+r]*=t[r*e+r],o=r+1;o<e;o++)t[r*e+r]+=t[o*e+r]*t[o*e+r];for(n=r+1;n<e;n++)for(o=n;o<e;o++)t[r*e+n]+=t[o*e+r]*t[o*e+n]}for(r=0;r<e;r++)for(n=0;n<r;n++)t[r*e+n]=t[n*e+r]}function w(t,e){var r,n,o,i,s,l,u,h,f,a,c,p=e,g=Array(e*e),y=Array(e),x=Array(e),v=Array(e);for(r=0;r<e;r++)for(i=0;i<e;i++)g[r*e+i]=r==i?1:0;for(i=0;i<e;i++)v[i]=0;for(r=0;r<e;r++){for(h=0,i=0;i<e;i++)if(1!=v[i])for(s=0;s<e;s++)0==v[s]&&Math.abs(t[i*e+s])>=h&&(h=Math.abs(t[i*e+s]),o=i,n=s);if(++v[n],o!=n){for(l=0;l<e;l++)c=t[o*e+l],t[o*e+l]=t[n*e+l],t[n*e+l]=c;for(l=0;l<p;l++)c=g[o*e+l],g[o*e+l]=g[n*e+l],g[n*e+l]=c}if(x[r]=o,y[r]=n,0==t[n*e+n])return!1;for(a=1/t[n*e+n],t[n*e+n]=1,l=0;l<e;l++)t[n*e+l]*=a;for(l=0;l<p;l++)g[n*e+l]*=a;for(u=0;u<e;u++)if(u!=n){for(f=t[u*e+n],t[u*e+n]=0,l=0;l<e;l++)t[u*e+l]-=t[n*e+l]*f;for(l=0;l<p;l++)g[u*e+l]-=g[n*e+l]*f}}for(l=e-1;l>=0;l--)if(x[l]!=y[l])for(s=0;s<e;s++)c=t[s*e+x[l]],t[s*e+x[l]]=t[s*e+y[l]],t[s*e+y[l]]=c;return!0}function _(t,e,r,n,o){return e+(n-e)/r*(1-Math.exp(-1/o*Math.pow(t/r,2)))}function S(t,e,r,n,o){return e+(n-e)/r*(1-Math.exp(-1/o*(t/r)))}function M(t,e,r,n,o){return t>r?e+(n-e)/r:e+(n-e)/r*(t/r*1.5-.5*Math.pow(t/r,3))}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var t,e;for(t=0,e=0;t<this.length;t++)e+=this[t];return e/this.length},Array.prototype.rep=function(t){for(var e=new Array(t),r=this[0],n=0;n<t;n++)e[n]=r;return e},Array.prototype.pip=function(t,e){var r,n,o=!1;for(r=0,n=this.length-1;r<this.length;n=r++)this[r][1]>e!=this[n][1]>e&&t<(this[n][0]-this[r][0])*(e-this[r][1])/(this[n][1]-this[r][1])+this[r][0]&&(o=!o);return o};var k={};function R(t,e){return t.map((function(t){return t.map((function(t){return[e.xlim[0]+t[0]*e.x_resolution,e.y_resolution<0?e.ylim[1]+t[1]*e.y_resolution:e.ylim[0]+t[1]*e.y_resolution]}))}))}function I(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function P(t){return"Feature"===t.type?t.geometry:t}
/**
   * splaytree v3.1.2
   * Fast Splay tree for Node and browser
   *
   * @author Alexander Milevski <info@w8r.name>
   * @license MIT
   * @preserve
   */
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function A(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}k.train=function(t,e,r,n,o,i){var s={t:t,x:e,y:r,nugget:0,range:0,sill:0,A:1/3,n:0};switch(n){case"gaussian":s.model=_;break;case"exponential":s.model=S;break;case"spherical":s.model=M}var l,u,h,f,a=t.length,c=Array((a*a-a)/2);for(l=0,h=0;l<a;l++)for(u=0;u<l;u++,h++)c[h]=Array(2),c[h][0]=Math.pow(Math.pow(e[l]-e[u],2)+Math.pow(r[l]-r[u],2),.5),c[h][1]=Math.abs(t[l]-t[u]);c.sort((function(t,e){return t[0]-e[0]})),s.range=c[(a*a-a)/2-1][0];var p=(a*a-a)/2>30?30:(a*a-a)/2,g=s.range/p,y=[0].rep(p),x=[0].rep(p);if(p<30)for(f=0;f<p;f++)y[f]=c[f][0],x[f]=c[f][1];else{for(l=0,u=0,h=0,f=0;l<p&&u<(a*a-a)/2;l++,h=0){for(;c[u][0]<=(l+1)*g&&(y[f]+=c[u][0],x[f]+=c[u][1],h++,!(++u>=(a*a-a)/2)););h>0&&(y[f]/=h,x[f]/=h,f++)}if(f<2)return s}a=f,s.range=y[a-1]-y[0];var k=[1].rep(2*a),R=Array(a),I=s.A;for(l=0;l<a;l++){switch(n){case"gaussian":k[2*l+1]=1-Math.exp(-1/I*Math.pow(y[l]/s.range,2));break;case"exponential":k[2*l+1]=1-Math.exp(-1/I*y[l]/s.range);break;case"spherical":k[2*l+1]=y[l]/s.range*1.5-.5*Math.pow(y[l]/s.range,3)}R[l]=x[l]}var P=function(t,e,r){var n,o,i=Array(r*e);for(n=0;n<e;n++)for(o=0;o<r;o++)i[o*e+n]=t[n*r+o];return i}(k,a,2),A=m(P,k,2,a,2),N=(A=d(A,v(1/i,2),2,2)).slice(0);b(A,2)?E(A,2):(w(N,2),A=N);var L=m(m(A,P,2,2,a),R,2,a,1);s.nugget=L[0],s.sill=L[1]*s.range+s.nugget,s.n=e.length,a=e.length;var O=Array(a*a);for(l=0;l<a;l++){for(u=0;u<l;u++)O[l*a+u]=s.model(Math.pow(Math.pow(e[l]-e[u],2)+Math.pow(r[l]-r[u],2),.5),s.nugget,s.range,s.sill,s.A),O[u*a+l]=O[l*a+u];O[l*a+l]=s.model(0,s.nugget,s.range,s.sill,s.A)}var z=d(O,v(o,a),a,a),C=z.slice(0);b(z,a)?E(z,a):(w(C,a),z=C);O=z.slice(0);var $=m(z,t,a,a,1);return s.K=O,s.M=$,s},k.predict=function(t,e,r){var n,o=Array(r.n);for(n=0;n<r.n;n++)o[n]=r.model(Math.pow(Math.pow(t-r.x[n],2)+Math.pow(e-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return m(o,r.M,1,r.n,1)[0]},k.variance=function(t,e,r){var n,o=Array(r.n);for(n=0;n<r.n;n++)o[n]=r.model(Math.pow(Math.pow(t-r.x[n],2)+Math.pow(e-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return r.model(0,r.nugget,r.range,r.sill,r.A)+m(m(o,r.K,1,r.n,r.n),o,1,r.n,1)[0]},k.getGridInfo=function(t,e,r){for(var n,o,i,s,l=[],u=[t[0],t[2]],h=[t[1],t[3]],f=[e.t.min(),e.t.max()],a=u[1]-u[0],c=h[1]-h[0],p=1*a/(n=r?Math.ceil(r):200),g=1*c/(o=Math.ceil(n/(a/c))),y=0;y<o;y++)for(var x=0;x<n;x++)i=t[0]+x*p,s=t[1]+y*g,l.push(k.predict(i,s,e));return{grid:l,n:n,m:o,xlim:u,ylim:h,zlim:f,x_resolution:p,y_resolution:g}},k.getVectorContour=function(t,e){for(var r=x().size([t.n,t.m]).thresholds(e)(t.grid),n={type:"FeatureCollection",features:[]},o=function(){var e=r[i];if("MultiPolygon"===e.type)e.coordinates.forEach((function(r){var o={type:"Polygon",coordinates:[]};o.coordinates=R(r,t),o.coordinates.length>0&&n.features.push({type:"Feature",properties:{value:e.value},geometry:o})}));else if("Polygon"===e.type){var o={type:"Polygon",coordinates:[]};o.coordinates=R(e.coordinates,t),o.coordinates.length>0&&n.features.push({type:"Feature",properties:{value:e.value},geometry:o})}},i=0;i<r.length;i++)o();return n},k.drawCanvasContour=function(t,e,r,n,o){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height);for(var s=[r[1]-r[0],n[1]-n[0],t.zlim[1]-t.zlim[0]],l=t.n,u=t.m,h=Math.ceil(t.x_resolution*e.width/(r[1]-r[0])),f=Math.ceil(t.y_resolution*e.height/(n[1]-n[0])),a=0;a<u;a++)for(var c=0;c<l;c++){var p=a*l+c;if(null!=t.grid[p]){var g=e.width*(c*t.x_resolution+t.xlim[0]-r[0])/s[0],y=e.height*(1-(a*t.y_resolution+t.ylim[0]-n[0])/s[1]),x=(t.grid[p]-t.zlim[0])/s[2];x<0?x=0:x>1&&(x=1),i.fillStyle=o[Math.floor((o.length-1)*x)],i.fillRect(Math.round(g-h/2),Math.round(y-f/2),h,f)}}};var N=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function L(t,e){return t>e?1:t<e?-1:0}function O(t,e,r){for(var n=new N(null,null),o=n,i=n;;){var s=r(t,e.key);if(s<0){if(null===e.left)break;if(r(t,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,null===(e=l).left)break}i.left=e,i=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(r(t,e.right.key)>0){l=e.right;if(e.right=l.left,l.left=e,null===(e=l).right)break}o.right=e,o=e,e=e.right}}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function z(t,e,r,n){var o=new N(t,e);if(null===r)return o.left=o.right=null,o;var i=n(t,(r=O(t,r,n)).key);return i<0?(o.left=r.left,o.right=r,r.left=null):i>=0&&(o.right=r.right,o.left=r,r.right=null),o}function C(t,e,r){var n=null,o=null;if(e){var i=r((e=O(t,e,r)).key,t);0===i?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function $(t,e,r,n,o){if(t){n(e+(r?"└── ":"├── ")+o(t)+"\n");var i=e+(r?"    ":"│   ");t.left&&$(t.left,i,!1,n,o),t.right&&$(t.right,i,!0,n,o)}}var G=function(){function t(t){void 0===t&&(t=L),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=z(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var r=new N(t,e);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var n=this._comparator,o=O(t,this._root,n),i=n(t,o.key);return 0===i?this._root=o:(i<0?(r.left=o.left,r.right=o,o.left=null):i>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,r){var n;return null===e?null:0===r(t,(e=O(t,e,r)).key)?(null===e.left?n=e.right:(n=O(t,e.left,r)).right=e.right,this._size--,n):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=O(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=O(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var r=this._root,n=[],o=!1;!o;)null!==r?(n.push(r),r=r.left):0!==n.length?(r=n.pop(),t.call(e,r),r=r.right):o=!0;return this},t.prototype.range=function(t,e,r,n){for(var o=[],i=this._comparator,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(i((s=o.pop()).key,e)>0)break;if(i(s.key,t)>=0&&r.call(n,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var r=e.key;return t.push(r)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var r=e.data;return t.push(r)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,r=!1,n=0,o=[];!r;)if(e)o.push(e),e=e.left;else if(o.length>0){if(e=o.pop(),n===t)return e;n++,e=e.right}else r=!0;return null},t.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var n=this._comparator;e;){var o=n(t.key,e.key);if(0===o)break;o<0?(r=e,e=e.left):e=e.right}return r},t.prototype.prev=function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var n=this._comparator;e;){var o=n(t.key,e.key);if(0===o)break;o<0?e=e.left:(r=e,e=e.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){var e=t,r=[],n=!1,o=new N(null,null),i=o;for(;!n;)e?(r.push(e),e=e.left):r.length>0?e=(e=i=i.next=r.pop()).right:n=!0;return i.next=null,o.next}(this._root)},t.prototype.load=function(t,e,r){void 0===e&&(e=[]),void 0===r&&(r=!1);var n=t.length,o=this._comparator;if(r&&q(t,e,0,n-1,o),null===this._root)this._root=B(t,e,0,n),this._size=n;else{var i=function(t,e,r){var n=new N(null,null),o=n,i=t,s=e;for(;null!==i&&null!==s;)r(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;null!==i?o.next=i:null!==s&&(o.next=s);return n.next}(this.toList(),function(t,e){for(var r=new N(null,null),n=r,o=0;o<t.length;o++)n=n.next=new N(t[o],e[o]);return n.next=null,r.next}(t,e),o);n=this._size+n,this._root=F({head:i},0,n)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return $(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,r){var n=this._comparator,o=C(t,this._root,n),i=o.left,s=o.right;n(t,e)<0?s=z(e,r,s,n):i=z(e,r,i,n),this._root=function(t,e,r){return null===e?t:(null===t||((e=O(t.key,e,r)).left=t),e)}(i,s,n)},t.prototype.split=function(t){return C(t,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var t,e,r;return A(this,(function(n){switch(n.label){case 0:t=this._root,e=[],r=!1,n.label=1;case 1:return r?[3,6]:null===t?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return 0===e.length?[3,4]:[4,t=e.pop()];case 3:return n.sent(),t=t.right,[3,5];case 4:r=!0,n.label=5;case 5:return[3,1];case 6:return[2]}}))},t}();function B(t,e,r,n){var o=n-r;if(o>0){var i=r+Math.floor(o/2),s=t[i],l=e[i],u=new N(s,l);return u.left=B(t,e,r,i),u.right=B(t,e,i+1,n),u}return null}function F(t,e,r){var n=r-e;if(n>0){var o=e+Math.floor(n/2),i=F(t,e,o),s=t.head;return s.left=i,t.head=t.head.next,s.right=F(t,o+1,r),s}return null}function q(t,e,r,n,o){if(!(r>=n)){for(var i=t[r+n>>1],s=r-1,l=n+1;;){do{s++}while(o(t[s],i)<0);do{l--}while(o(t[l],i)>0);if(s>=l)break;var u=t[s];t[s]=t[l],t[l]=u,u=e[s],e[s]=e[l],e[l]=u}q(t,e,r,l,o),q(t,e,l+1,n,o)}}const T=134217729,V=33306690738754706e-32;function j(t,e,r,n,o){let i,s,l,u,h=e[0],f=n[0],a=0,c=0;f>h==f>-h?(i=h,h=e[++a]):(i=f,f=n[++c]);let p=0;if(a<t&&c<r)for(f>h==f>-h?(s=h+i,l=i-(s-h),h=e[++a]):(s=f+i,l=i-(s-f),f=n[++c]),i=s,0!==l&&(o[p++]=l);a<t&&c<r;)f>h==f>-h?(s=i+h,u=s-i,l=i-(s-u)+(h-u),h=e[++a]):(s=i+f,u=s-i,l=i-(s-u)+(f-u),f=n[++c]),i=s,0!==l&&(o[p++]=l);for(;a<t;)s=i+h,u=s-i,l=i-(s-u)+(h-u),h=e[++a],i=s,0!==l&&(o[p++]=l);for(;c<r;)s=i+f,u=s-i,l=i-(s-u)+(f-u),f=n[++c],i=s,0!==l&&(o[p++]=l);return 0===i&&0!==p||(o[p++]=i),p}function U(t){return new Float64Array(t)}const Y=22204460492503146e-32,K=11093356479670487e-47,W=U(4),X=U(8),Q=U(12),Z=U(16),D=U(4);function H(t,e,r,n,o,i){const s=(e-i)*(r-o),l=(t-o)*(n-i),u=s-l,h=Math.abs(s+l);return Math.abs(u)>=33306690738754716e-32*h?u:-function(t,e,r,n,o,i,s){let l,u,h,f,a,c,p,g,y,x,v,d,m,b,E,w,_,S;const M=t-o,k=r-o,R=e-i,I=n-i;b=M*I,c=T*M,p=c-(c-M),g=M-p,c=T*I,y=c-(c-I),x=I-y,E=g*x-(b-p*y-g*y-p*x),w=R*k,c=T*R,p=c-(c-R),g=R-p,c=T*k,y=c-(c-k),x=k-y,_=g*x-(w-p*y-g*y-p*x),v=E-_,a=E-v,W[0]=E-(v+a)+(a-_),d=b+v,a=d-b,m=b-(d-a)+(v-a),v=m-w,a=m-v,W[1]=m-(v+a)+(a-w),S=d+v,a=S-d,W[2]=d-(S-a)+(v-a),W[3]=S;let P=function(t,e){let r=e[0];for(let n=1;n<t;n++)r+=e[n];return r}(4,W),A=Y*s;if(P>=A||-P>=A)return P;if(a=t-M,l=t-(M+a)+(a-o),a=r-k,h=r-(k+a)+(a-o),a=e-R,u=e-(R+a)+(a-i),a=n-I,f=n-(I+a)+(a-i),0===l&&0===u&&0===h&&0===f)return P;if(A=K*s+V*Math.abs(P),P+=M*f+I*l-(R*h+k*u),P>=A||-P>=A)return P;b=l*I,c=T*l,p=c-(c-l),g=l-p,c=T*I,y=c-(c-I),x=I-y,E=g*x-(b-p*y-g*y-p*x),w=u*k,c=T*u,p=c-(c-u),g=u-p,c=T*k,y=c-(c-k),x=k-y,_=g*x-(w-p*y-g*y-p*x),v=E-_,a=E-v,D[0]=E-(v+a)+(a-_),d=b+v,a=d-b,m=b-(d-a)+(v-a),v=m-w,a=m-v,D[1]=m-(v+a)+(a-w),S=d+v,a=S-d,D[2]=d-(S-a)+(v-a),D[3]=S;const N=j(4,W,4,D,X);b=M*f,c=T*M,p=c-(c-M),g=M-p,c=T*f,y=c-(c-f),x=f-y,E=g*x-(b-p*y-g*y-p*x),w=R*h,c=T*R,p=c-(c-R),g=R-p,c=T*h,y=c-(c-h),x=h-y,_=g*x-(w-p*y-g*y-p*x),v=E-_,a=E-v,D[0]=E-(v+a)+(a-_),d=b+v,a=d-b,m=b-(d-a)+(v-a),v=m-w,a=m-v,D[1]=m-(v+a)+(a-w),S=d+v,a=S-d,D[2]=d-(S-a)+(v-a),D[3]=S;const L=j(N,X,4,D,Q);b=l*f,c=T*l,p=c-(c-l),g=l-p,c=T*f,y=c-(c-f),x=f-y,E=g*x-(b-p*y-g*y-p*x),w=u*h,c=T*u,p=c-(c-u),g=u-p,c=T*h,y=c-(c-h),x=h-y,_=g*x-(w-p*y-g*y-p*x),v=E-_,a=E-v,D[0]=E-(v+a)+(a-_),d=b+v,a=d-b,m=b-(d-a)+(v-a),v=m-w,a=m-v,D[1]=m-(v+a)+(a-w),S=d+v,a=S-d,D[2]=d-(S-a)+(v-a),D[3]=S;const O=j(L,Q,4,D,Z);return Z[O-1]}(t,e,r,n,o,i,h)}const J=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,tt=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let et=Number.EPSILON;void 0===et&&(et=Math.pow(2,-52));const rt=et*et,nt=(t,e)=>{if(-et<t&&t<et&&-et<e&&e<et)return 0;const r=t-e;return r*r<rt*t*e?0:t<e?-1:1};class ot{constructor(){this.tree=new G,this.round(0)}round(t){const e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===nt(e.key,r.key))return this.tree.remove(t),r.key;const n=this.tree.next(e);return null!==n&&0===nt(e.key,n.key)?(this.tree.remove(t),n.key):t}}const it=new class{constructor(){this.reset()}reset(){this.xRounder=new ot,this.yRounder=new ot}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}},st=(t,e)=>t.x*e.y-t.y*e.x,lt=(t,e)=>t.x*e.x+t.y*e.y,ut=(t,e,r)=>{const n=H(t.x,t.y,e.x,e.y,r.x,r.y);return n>0?-1:n<0?1:0},ht=t=>Math.sqrt(lt(t,t)),ft=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},o={x:r.x-t.x,y:r.y-t.y};return st(o,n)/ht(o)/ht(n)},at=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},o={x:r.x-t.x,y:r.y-t.y};return lt(o,n)/ht(o)/ht(n)},ct=(t,e,r)=>0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r},pt=(t,e,r)=>0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)};class gt{static compare(t,e){const r=gt.comparePoints(t.point,e.point);return 0!==r?r:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:xt.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,r=e.length;t<r;t++){const r=e[t];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const r=this.point.events[e];if(void 0===r.segment.consumedBy)for(let n=e+1;n<t;n++){const t=this.point.events[n];void 0===t.consumedBy&&(r.otherSE.point.events===t.otherSE.point.events&&r.segment.consume(t.segment))}}}getAvailableLinkedEvents(){const t=[];for(let e=0,r=this.point.events.length;e<r;e++){const r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}getLeftmostComparator(t){const e=new Map,r=r=>{const n=r.otherSE;e.set(r,{sine:ft(this.point,t.point,n.point),cosine:at(this.point,t.point,n.point)})};return(t,n)=>{e.has(t)||r(t),e.has(n)||r(n);const{sine:o,cosine:i}=e.get(t),{sine:s,cosine:l}=e.get(n);return o>=0&&s>=0?i<l?1:i>l?-1:0:o<0&&s<0?i<l?-1:i>l?1:0:s<o?-1:s>o?1:0}}}let yt=0;class xt{static compare(t,e){const r=t.leftSE.point.x,n=e.leftSE.point.x,o=t.rightSE.point.x,i=e.rightSE.point.x;if(i<r)return 1;if(o<n)return-1;const s=t.leftSE.point.y,l=e.leftSE.point.y,u=t.rightSE.point.y,h=e.rightSE.point.y;if(r<n){if(l<s&&l<u)return 1;if(l>s&&l>u)return-1;const r=t.comparePoint(e.leftSE.point);if(r<0)return 1;if(r>0)return-1;const n=e.comparePoint(t.rightSE.point);return 0!==n?n:-1}if(r>n){if(s<l&&s<h)return-1;if(s>l&&s>h)return 1;const r=e.comparePoint(t.leftSE.point);if(0!==r)return r;const n=t.comparePoint(e.rightSE.point);return n<0?1:n>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(o<i){const r=e.comparePoint(t.rightSE.point);if(0!==r)return r}if(o>i){const r=t.comparePoint(e.rightSE.point);if(r<0)return 1;if(r>0)return-1}if(o!==i){const t=u-s,e=o-r,f=h-l,a=i-n;if(t>e&&f<a)return 1;if(t<e&&f>a)return-1}return o>i?1:o<i||u<h?-1:u>h?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,r,n){this.id=++yt,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=r,this.windings=n}static fromRing(t,e,r){let n,o,i;const s=gt.comparePoints(t,e);if(s<0)n=t,o=e,i=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);n=e,o=t,i=-1}const l=new gt(n,!0),u=new gt(o,!1);return new xt(l,u,[r],[i])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;const o=(t.y-e.y)/n.y,i=e.x+o*n.x;if(t.x===i)return 0;const s=(t.x-e.x)/n.x,l=e.y+s*n.y;return t.y===l?0:t.y<l?-1:1}getIntersection(t){const e=this.bbox(),r=t.bbox(),n=tt(e,r);if(null===n)return null;const o=this.leftSE.point,i=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,u=J(e,s)&&0===this.comparePoint(s),h=J(r,o)&&0===t.comparePoint(o),f=J(e,l)&&0===this.comparePoint(l),a=J(r,i)&&0===t.comparePoint(i);if(h&&u)return a&&!f?i:!a&&f?l:null;if(h)return f&&o.x===l.x&&o.y===l.y?null:o;if(u)return a&&i.x===s.x&&i.y===s.y?null:s;if(a&&f)return null;if(a)return i;if(f)return l;const c=((t,e,r,n)=>{if(0===e.x)return pt(r,n,t.x);if(0===n.x)return pt(t,e,r.x);if(0===e.y)return ct(r,n,t.y);if(0===n.y)return ct(t,e,r.y);const o=st(e,n);if(0==o)return null;const i={x:r.x-t.x,y:r.y-t.y},s=st(i,e)/o,l=st(i,n)/o;return{x:(t.x+l*e.x+(r.x+s*n.x))/2,y:(t.y+l*e.y+(r.y+s*n.y))/2}})(o,this.vector(),s,t.vector());return null===c?null:J(n,c)?it.round(c.x,c.y):null}split(t){const e=[],r=void 0!==t.events,n=new gt(t,!0),o=new gt(t,!1),i=this.rightSE;this.replaceRightSE(o),e.push(o),e.push(n);const s=new xt(n,i,this.rings.slice(),this.windings.slice());return gt.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),gt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),o.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,r=t;for(;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const n=xt.compare(e,r);if(0!==n){if(n>0){const t=e;e=r,r=t}if(e.prev===r){const t=e;e=r,r=t}for(let t=0,n=r.rings.length;t<n;t++){const n=r.rings[t],o=r.windings[t],i=e.rings.indexOf(n);-1===i?(e.rings.push(n),e.windings.push(o)):e.windings[i]+=o}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let t=0,n=this.rings.length;t<n;t++){const n=this.rings[t],o=this.windings[t],i=e.indexOf(n);-1===i?(e.push(n),r.push(o)):r[i]+=o}const o=[],i=[];for(let t=0,n=e.length;t<n;t++){if(0===r[t])continue;const n=e[t],s=n.poly;if(-1===i.indexOf(s))if(n.isExterior)o.push(s);else{-1===i.indexOf(s)&&i.push(s);const t=o.indexOf(n.poly);-1!==t&&o.splice(t,1)}}for(let t=0,e=o.length;t<e;t++){const e=o[t].multiPoly;-1===n.indexOf(e)&&n.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(kt.type){case"union":{const r=0===t.length,n=0===e.length;this._isInResult=r!==n;break}case"intersection":{let r,n;t.length<e.length?(r=t.length,n=e.length):(r=e.length,n=t.length),this._isInResult=n===kt.numMultiPolys&&r<n;break}case"xor":{const r=Math.abs(t.length-e.length);this._isInResult=r%2==1;break}case"difference":{const r=t=>1===t.length&&t[0].isSubject;this._isInResult=r(t)!==r(e);break}default:throw new Error(`Unrecognized operation type found ${kt.type}`)}return this._isInResult}}class vt{constructor(t,e,r){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=it.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let o=n;for(let e=1,r=t.length;e<r;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=it.round(t[e][0],t[e][1]);r.x===o.x&&r.y===o.y||(this.segments.push(xt.fromRing(o,r,this)),r.x<this.bbox.ll.x&&(this.bbox.ll.x=r.x),r.y<this.bbox.ll.y&&(this.bbox.ll.y=r.y),r.x>this.bbox.ur.x&&(this.bbox.ur.x=r.x),r.y>this.bbox.ur.y&&(this.bbox.ur.y=r.y),o=r)}n.x===o.x&&n.y===o.y||this.segments.push(xt.fromRing(o,n,this))}getSweepEvents(){const t=[];for(let e=0,r=this.segments.length;e<r;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}class dt{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new vt(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,r=t.length;e<r;e++){const r=new vt(t[e],this,!1);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class mt{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,r=t.length;e<r;e++){const r=new dt(t[e],this);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class bt{static factory(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.isInResult()||n.ringOut)continue;let o=null,i=n.leftSE,s=n.rightSE;const l=[i],u=i.point,h=[];for(;o=i,i=s,l.push(i),i.point!==u;)for(;;){const t=i.getAvailableLinkedEvents();if(0===t.length){const t=l[0].point,e=l[l.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){s=t[0].otherSE;break}let r=null;for(let t=0,e=h.length;t<e;t++)if(h[t].point===i.point){r=t;break}if(null!==r){const t=h.splice(r)[0],n=l.splice(t.index);n.unshift(n[0].otherSE),e.push(new bt(n.reverse()));continue}h.push({index:l.length,point:i.point});const n=i.getLeftmostComparator(o);s=t.sort(n)[0].otherSE;break}e.push(new bt(l))}return e}constructor(t){this.events=t;for(let e=0,r=t.length;e<r;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let r=1,n=this.events.length-1;r<n;r++){const n=this.events[r].point,o=this.events[r+1].point;0!==ut(n,t,o)&&(e.push(n),t=n)}if(1===e.length)return null;const r=e[0],n=e[1];0===ut(r,t,n)&&e.shift(),e.push(e[0]);const o=this.isExteriorRing()?1:-1,i=this.isExteriorRing()?0:e.length-1,s=this.isExteriorRing()?e.length:-1,l=[];for(let t=i;t!=s;t+=o)l.push([e[t].x,e[t].y]);return l}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,r=this.events.length;e<r;e++){const r=this.events[e];gt.compare(t,r)>0&&(t=r)}let e=t.segment.prevInResult(),r=e?e.prevInResult():null;for(;;){if(!e)return null;if(!r)return e.ringOut;if(r.ringOut!==e.ringOut)return r.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=r.prevInResult(),r=e?e.prevInResult():null}}}class Et{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}class wt{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}_composePolys(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.poly)if(n.isExteriorRing())e.push(new Et(n));else{const t=n.enclosingRing();t.poly||e.push(new Et(t)),t.poly.addInterior(n)}}return e}}class _t{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt.compare;this.queue=t,this.tree=new G(e),this.segments=[]}process(t){const e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;const n=t.isLeft?this.tree.add(e):this.tree.find(e);if(!n)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let o,i,s=n,l=n;for(;void 0===o;)s=this.tree.prev(s),null===s?o=null:void 0===s.key.consumedBy&&(o=s.key);for(;void 0===i;)l=this.tree.next(l),null===l?i=null:void 0===l.key.consumedBy&&(i=l.key);if(t.isLeft){let n=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(n=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}let s=null;if(i){const t=i.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(s=t),!i.isAnEndpoint(t))){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}if(null!==n||null!==s){let t=null;if(null===n)t=s;else if(null===s)t=n;else{t=gt.comparePoints(n,s)<=0?n:s}this.queue.remove(e.rightSE),r.push(e.rightSE);const o=e.split(t);for(let t=0,e=o.length;t<e;t++)r.push(o[t])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=o)}else{if(o&&i){const t=o.getIntersection(i);if(null!==t){if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}if(!i.isAnEndpoint(t)){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}}this.tree.remove(e)}return r}_splitSafely(t,e){this.tree.remove(t);const r=t.rightSE;this.queue.remove(r);const n=t.split(e);return n.push(r),void 0===t.consumedBy&&this.tree.add(t),n}}const St="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Mt="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;const kt=new class{run(t,e,r){kt.type=t,it.reset();const n=[new mt(e,!0)];for(let t=0,e=r.length;t<e;t++)n.push(new mt(r[t],!1));if(kt.numMultiPolys=n.length,"difference"===kt.type){const t=n[0];let e=1;for(;e<n.length;)null!==tt(n[e].bbox,t.bbox)?e++:n.splice(e,1)}if("intersection"===kt.type)for(let t=0,e=n.length;t<e;t++){const e=n[t];for(let r=t+1,o=n.length;r<o;r++)if(null===tt(e.bbox,n[r].bbox))return[]}const o=new G(gt.compare);for(let t=0,e=n.length;t<e;t++){const e=n[t].getSweepEvents();for(let t=0,r=e.length;t<r;t++)if(o.insert(e[t]),o.size>St)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const i=new _t(o);let s=o.size,l=o.pop();for(;l;){const t=l.key;if(o.size===s){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(o.size>St)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(i.segments.length>Mt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=i.process(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0===r.consumedBy&&o.insert(r)}s=o.size,l=o.pop()}it.reset();const u=bt.factory(i.segments);return new wt(u).getGeom()}};var Rt={union:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return kt.run("union",t,r)},intersection:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return kt.run("intersection",t,r)},xor:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return kt.run("xor",t,r)},difference:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return kt.run("difference",t,r)}};function It(t,e,r){void 0===r&&(r={});var n=P(t),o=P(e),i=Rt.intersection(n.coordinates,o.coordinates);return 0===i.length?null:1===i.length?function(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return I({type:"Polygon",coordinates:t},e,r)}(i[0],r.properties):function(t,e,r){return void 0===r&&(r={}),I({type:"MultiPolygon",coordinates:t},e,r)}(i,r.properties)}function Pt(t,e,r){var n=[],o=[],i=[],s=[1e8,1e8,-1e8,-1e8];t.features.forEach((function(t){n.push(t.properties[e]),o.push(t.geometry.coordinates[0]),i.push(t.geometry.coordinates[1]),s[0]>t.geometry.coordinates[0]&&(s[0]=t.geometry.coordinates[0]),s[1]>t.geometry.coordinates[1]&&(s[1]=t.geometry.coordinates[1]),s[2]<t.geometry.coordinates[0]&&(s[2]=t.geometry.coordinates[0]),s[3]<t.geometry.coordinates[1]&&(s[3]=t.geometry.coordinates[1])}));var l=k.train(n,o,i,r.model,r.sigma2,r.alpha);return k.getGridInfo(s,l,200)}t.drawCanvasContour=function(t,e,r,n,o,i,s){var l=Pt(t,e,r);k.drawCanvasContour(l,n,o,i,s)},t.getVectorContour=function(t,e,r,n){var o=Pt(t,e,r);return k.getVectorContour(o,n)},t.getVectorContourWithClip=function(t,e,r,n,o){var i=Pt(t,e,r),s=k.getVectorContour(i,n),l={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:o}},u=s.features.map((function(t){var e=It(t,l);return null!==e&&(e.properties=t.properties),e}));return u=u.filter((function(t){return null!==t}))},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=kriging_contour.js.map
